<div class="employee-list">
  <div class="page-header">
    <h1>Employés</h1>
    <app-button
      *ngIf="canCreate()"
      variant="primary"
      routerLink="/employee/create"
    >
      Ajouter un employé
    </app-button>
  </div>

  <!-- Filtres et recherche -->
  <app-card class="filters-card" *ngIf="!loading()">
    <div class="filters-row">
      <div class="search-group">
        <input
          type="text"
          [value]="searchTerm()"
          (input)="searchTerm.set($any($event.target).value)"
          (keyup.enter)="onSearch()"
          placeholder="Rechercher par nom, email, ID..."
          class="search-input"
        />
        <button class="search-button" (click)="onSearch()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
            <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>
      <div class="filter-group">
        <label>Statut:</label>
        <select [value]="statusFilter()" (change)="onStatusFilterChange($any($event.target).value)" class="filter-select">
          <option value="all">Tous</option>
          <option value="active">Actif</option>
          <option value="on_leave">En congé</option>
          <option value="inactive">Inactif</option>
        </select>
      </div>
    </div>
  </app-card>

  <app-loading *ngIf="loading()" message="Chargement des employés..."></app-loading>

  <div *ngIf="!loading() && employees().length === 0" class="empty-state">
    <app-card>
      <p>Aucun employé trouvé</p>
      <app-button *ngIf="canCreate()" variant="primary" routerLink="/employee/create">
        Ajouter le premier employé
      </app-button>
    </app-card>
  </div>

  <div *ngIf="!loading() && employees().length > 0" class="employees-grid">
    <app-card *ngFor="let employee of employees()" class="employee-card" [routerLink]="['/employee', employee.id]">
      <div class="employee-header">
        <div class="employee-avatar">
          <img *ngIf="getEmployeeImageUrl(employee)" [src]="getEmployeeImageUrl(employee)" [alt]="employee.full_name || employee.first_name + ' ' + employee.last_name" />
          <span *ngIf="!getEmployeeImageUrl(employee)" class="avatar-placeholder">
            {{ getEmployeeInitials(employee) }}
          </span>
        </div>
        <div class="employee-info">
          <h3 class="employee-name">{{ employee.full_name || employee.first_name + ' ' + employee.last_name }}</h3>
          <span class="employee-id">ID: {{ employee.employee_id }}</span>
        </div>
        <span [class]="'badge ' + getStatusBadgeClass(employee.status)">
          {{ getStatusDisplay(employee.status) }}
        </span>
      </div>

      <div class="employee-content">
        <div class="info-item">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2"/>
            <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span>{{ employee.email }}</span>
        </div>
        <div class="info-item" *ngIf="employee.phone">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span>{{ employee.phone }}</span>
        </div>
        <div class="info-item" *ngIf="employee.department_name">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2"/>
            <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span>{{ employee.department_name }}</span>
        </div>
        <div class="info-item" *ngIf="employee.position_name">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
            <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            <path d="M20 8v6M23 11h-6" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span>{{ employee.position_name }}</span>
        </div>
        <div class="salary-info" *ngIf="employee.salary">
          <span class="salary-label">Salaire:</span>
          <span class="salary-value">{{ formatSalary(employee.salary) }}</span>
        </div>
      </div>

      <div class="employee-footer" *ngIf="canEdit()" (click)="$event.stopPropagation()">
        <button class="icon-button" routerLink="/employee/{{ employee.id }}/edit" aria-label="Modifier">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </button>
        <button class="icon-button danger" (click)="deleteEmployee(employee.id)" aria-label="Supprimer">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </button>
      </div>
    </app-card>
  </div>
</div>

