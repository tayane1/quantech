<div class="change-password">
  <h1 class="page-title">Changer le mot de passe</h1>

  <app-card title="Sécurité">
    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="password-form">
      <div class="form-group">
        <label for="old_password">Mot de passe actuel *</label>
        <input
          type="password"
          id="old_password"
          formControlName="old_password"
          [class.invalid]="isFieldInvalid('old_password')"
        />
        <span class="error-message" *ngIf="isFieldInvalid('old_password')">
          {{ getFieldError('old_password') }}
        </span>
      </div>

      <div class="form-group">
        <label for="new_password">Nouveau mot de passe *</label>
        <input
          type="password"
          id="new_password"
          formControlName="new_password"
          [class.invalid]="isFieldInvalid('new_password')"
        />
        <span class="error-message" *ngIf="isFieldInvalid('new_password')">
          {{ getFieldError('new_password') }}
        </span>
        <small class="help-text">Minimum 8 caractères</small>
      </div>

      <div class="form-group">
        <label for="confirm_password">Confirmer le nouveau mot de passe *</label>
        <input
          type="password"
          id="confirm_password"
          formControlName="confirm_password"
          [class.invalid]="isFieldInvalid('confirm_password') || passwordForm.hasError('passwordMismatch')"
        />
        <span class="error-message" *ngIf="isFieldInvalid('confirm_password')">
          {{ getFieldError('confirm_password') }}
        </span>
        <span class="error-message" *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirm_password')?.touched">
          {{ getFormError() }}
        </span>
      </div>

      <div class="error-message" *ngIf="error()">
        {{ error() }}
      </div>

      <div class="success-message" *ngIf="success()">
        Mot de passe modifié avec succès ! Redirection en cours...
      </div>

      <div class="form-actions">
        <app-button
          type="button"
          variant="outline"
          (clicked)="router.navigate(['/profile'])"
          [disabled]="saving()"
        >
          Annuler
        </app-button>
        <app-button
          type="submit"
          variant="primary"
          [loading]="saving()"
          [disabled]="passwordForm.invalid"
        >
          Enregistrer
        </app-button>
      </div>
    </form>
  </app-card>
</div>

