<div class="notification-dropdown">
  <button
    class="notification-button"
    (click)="toggleDropdown()"
    [class.has-unread]="unreadCount() > 0"
    aria-label="Notifications"
  >
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path
        d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M13.73 21a2 2 0 0 1-3.46 0"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
    <span class="badge" *ngIf="unreadCount() > 0">{{ unreadCount() > 99 ? '99+' : unreadCount() }}</span>
  </button>

  <div class="dropdown-menu" *ngIf="showDropdown()" (clickOutside)="closeDropdown()">
    <div class="dropdown-header">
      <h3>Notifications</h3>
      <button
        class="mark-all-read"
        *ngIf="unreadCount() > 0"
        (click)="markAllAsRead()"
        aria-label="Marquer tout comme lu"
      >
        Tout marquer comme lu
      </button>
    </div>

    <div class="dropdown-content">
      <app-loading *ngIf="loading()" message="Chargement..."></app-loading>

      <div *ngIf="!loading() && notifications().length === 0" class="empty-notifications">
        <p>Aucune notification</p>
      </div>

      <div *ngIf="!loading() && notifications().length > 0" class="notifications-list">
        <div
          *ngFor="let notification of notifications()"
          class="notification-item"
          [class.unread]="!notification.is_read"
          (click)="handleNotificationClick(notification)"
        >
          <div class="notification-icon" [style.color]="getNotificationColor(notification.notification_type)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path
                [attr.d]="getNotificationIcon(notification.notification_type)"
                stroke="currentColor"
                stroke-width="2"
                fill="none"
              />
            </svg>
          </div>
          <div class="notification-content">
            <div class="notification-header">
              <h4 class="notification-title">{{ notification.title }}</h4>
              <div class="notification-actions">
                <button
                  class="action-button"
                  *ngIf="!notification.is_read"
                  (click)="markAsRead(notification, $event)"
                  aria-label="Marquer comme lu"
                >
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                    <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                <button
                  class="action-button"
                  (click)="deleteNotification(notification.id, $event)"
                  aria-label="Supprimer"
                >
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                    <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" fill="none"/>
                  </svg>
                </button>
              </div>
            </div>
            <p class="notification-message">{{ notification.message }}</p>
            <span class="notification-time">{{ getRelativeTime(notification.created_at) }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="dropdown-footer" *ngIf="!loading() && notifications().length > 0">
      <a routerLink="/notifications" (click)="closeDropdown()">Voir toutes les notifications</a>
    </div>
  </div>
</div>

